<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Checkout</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  </head>
  <body class="bg-light">
    <div class="container my-5">
      <h1 class="text-center mb-4">Shipping Address</h1>
      <form class="col-md-6 mx-auto">
        <div class="mb-3">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-control" name="name" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Address</label>
          <input type="text" class="form-control" name="address" required />
        </div>
        <div class="mb-3">
          <label class="form-label">City</label>
          <input type="text" class="form-control" name="city" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Postal Code</label>
          <input type="text" class="form-control" name="postal" required />
        </div>
        <div class="text-center">
          <button id="payBtn" class="btn btn-primary">Place Order</button>
        </div>
      </form>
    </div>
    <script>
      document.getElementById("payBtn").onclick = async function () {
        const orderRes = await fetch("/create-order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount: 500 }), // INR 500
        });
        console.log(3);
        const order = await orderRes.json();
        console.log(4);
        var options = {
          key: "<%= process.env.RAZORPAY_KEY_ID %>", // Replace with your key
          amount: order.amount,
          currency: order.currency,
          order_id: order.id,
          handler: async function (response) {
            const verifyRes = await fetch("/verify-payment", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(response),
            });
            const result = await verifyRes.json();
            alert(result.success ? "Payment successful!" : "Payment failed!");
            const orderRes = await fetch("/checkout", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name: "Dinesh",
                email: "dinesh.k.dhanasekaran@gmail.com",
                address: "asdasd",
                city: "asdasd",
                postal: "asdasd",
              }), // INR 500
            });
            const result1 = await orderRes.json();
            window.location.href = result1.redirect;
          },
        };
        var rzp = new Razorpay(options);
        rzp.open();
      };
    </script>
  </body>
</html>
